pipeline {
    agent any

    environment {
        // Thay bằng Docker Hub username hoặc registry bạn dùng
        DOCKER_HUB = "truongcongly"
        FRONTEND_IMAGE = "${DOCKER_HUB}/frontend:latest"
        BACKEND_IMAGE = "${DOCKER_HUB}/backend:latest"
        // EC2 user và IP
        // EC2_USER = "ubuntu"
        // EC2_HOST = "<EC2_IP>"
        // DEPLOY_SCRIPT = "~/deploy_to_ec2.sh"
    }

    stages {

        stage('Build & Push Docker Images') {
            steps {
                script {
                    // Build FE
                    sh """
                        docker build -t ${FRONTEND_IMAGE} ./frontend
                    """
                    // Build BE
                    sh """
                        docker build -t ${BACKEND_IMAGE} ./backend
                    """
                    // Push FE
                    sh "docker push ${FRONTEND_IMAGE}"
                    // Push BE
                    sh "docker push ${BACKEND_IMAGE}"
                }
            }
        }

        stage('Deploy to EC2') {
            // steps {
            //     // SSH agent sử dụng key đã lưu trong Jenkins Credentials
            //     sshagent(['ec2-deploy-key']) {
            //         sh """
            //             ssh -o StrictHostKeyChecking=no ${EC2_USER}@${EC2_HOST} \\
            //             'bash -s' < ${DEPLOY_SCRIPT}
            //         """
            //     }
            // }
        }

        stage('Notify') {
            steps {
                echo "Deployment process finished. Check the EC2 instance for updates."
            }
        }

    }

    post {
        success {
            echo "Pipeline completed successfully!"
        }
        failure {
            echo "Pipeline failed!"
        }
    }
}
